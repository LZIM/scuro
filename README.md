
# From R Markdown to PDF Slides, Fussily

This package provides [rmarkdown](http://rmarkdown.rstudio.com) formats and a template for creating presentation slides from R Markdown source, outputting to PDF using [Beamer](http://ctan.org/pkg/beamer) to create slides, speaker notes, and audience handouts from a single source file. The color scheme is light-on-dark, using a system font (and not the trademark ugly sans-serif Beamer default) in both slide text and in figures generated by R. A supplied [ggplot2](http://ggplot2.org) theme makes plots from ggplot as well as from base graphics likewise light-on-dark. Otherwise, it is very similar to the [default pandoc Beamer formats](http://rmarkdown.rstudio.com/beamer_presentation_format.html).

# The formats

There are three formats: `scuro::slides`, 
`scuro::notes`, and `scuro::handout`. Ordinarily these are used by adding, e.g. `output: scuro::slides` to the YAML metadata block at the start of your Rmd file.  To use all three, do something like

```yaml
mainfont: Gill Sans
output:
    - scuro::slides
    - scuro::notes
    - scuro::handout
```

The choice of font is of course up to you, and depends on what you have available. Then, in R,

```R
rmarkdown::render("talk.Rmd", "all")
```

RStudio does not seem to recognize multiple custom formats, so RStudio's "Knit" button (or keyboard shortcut) will only produce the first output format on the list.

The `slides` format creates slides for projection; the `notes` format creates sheets with two slides and two pages of accompanying notes (specified using beamer's `\note{}` command) each; and the `handout` format creates sheets with two slides and two blank spaces for audience notes each. One weakness of the dark-on-light scheme is that it doesn't look great on paper; I have been unable to come up with a general solution to this (e.g. automatically inverting graphics).

You do not need to load the `scuro` library in your Rmd file.

## Overlay specifications (incremental builds)

Beamer supports what it calls "overlay specifications," that is, ways of generating multiple copies of a slide with varying pieces of the content visible. But the `<1,3>` notation beamer uses doesn't always work well with pandoc's markdown processing. This package kludgily fixes this issue with a [pandoc filter](inst/python/overlay_filter). Instead of beamer's `<...>`, however, you should use `{<...>}`, as in

```latex
\note{<1,3>}{I am a note for stages 1 and 3.}
```

## Grid positioning

The minimalism of markdown and the text-oriented nature of LaTeX combine to make any tweaking of the layout of slides quite tricky. This is supposed to be a feature: this whole generating-from-plain-text thing is supposed to enable you to avoid laying things out! Nonetheless, sometimes a slide really does need a more complex layout than the basically left-to-right, top-to-bottom text-like sequencing of markdown. This package lets you use the [textpos](http://ctan.org/pkg/textpos) LaTeX package's grid-positioning features in your markdown. It sets up a 9 x 8 grid (and LaTeX length units `\TPHorizModule` and `TPVertModule`), and you can use the LaTeX `textblock` environment in your markdown as normal:

```latex
\begin{textblock}(2){4, 3}
A two-unit-wide block with upper left corner at grid position 4, 3
\end{textblock}
```

knitr's chunk options for figures are also modified to interact with this. If a chunk has a `textblock_width` option, its output will be placed in a `textblock` environment of the specified width in grid units at a position given by the `textblock_pos` option (a two-element vector of grid coordinates); the `out.width` and `out.height` options are reinterpreted as grid units. If you wish to use the grid units but not the `textblock` environment, instead use the `inside_textblock=T` chunk option. For more details, see the package help in R on `plot_hook_textpos`.

## Other tweaks

A few further knitr [chunk options](http://yihui.name/knitr/options/) have different defaults from the built-in formats: `tidy` is off, `size` is `footnotesize` (which works out fine when you project the PDF) and `dev.args` is `list(pointsize=9)`. The package also sets up a custom option, `dark_theme`, which applies the `dark_plot_theme` contained in the package (see its help topic in R) to all ggplots. This is on by default, but if you wish to fall back to the ggplot default, set `dark_theme=F` (and/or simply add your own `theme()` to plots).

The package defaults to TikZ graphics and the xelatex engine. This is slower than pdf graphics and pdflatex but visually worth it. If you are using TikZ but want to alter the tikzDevice options, note that the package installs a chunk hook to the `tikz_xelatex` option and sets all chunks to default to `tikz_xelatex=T`. Turn this off to change things (e.g. if you want a different font from the document main font in your graphics).

Otherwise, the underlying pandoc template is close to the default beamer template, with a few tweaks and a few choices I've made for you. In particular, note that graphics are *not* automatically scaled to the size of the slide, which I find to be a frequent source of mysterious errors. Some of the annoying beamer gewgaws are suppressed as well.

# Example usage: a template

The package also includes an rmarkdown template demonstrating the features described above. To use this template, use RStudio's "New File > R Markdown..." command, and select "Dark-on-Light Beamer Slides." Or, in R, do

```R
rmarkdown::draft(file="lecture", template="talk",
    package="scuro", edit=F)
```

which creates a new directory called `lecture` under the working directory and places an R Markdown file in it with the demonstration code. It also includes a Makefile for command-line control (which I much prefer to R Markdown: RStudio and knitr are great, but they are not a build system). `make all` generates slides, notes, and handout in sequence. (Somewhat annoyingly, this requires re-running the code in your R chunks three times. If you have long-running data analyses, you may wish to do some manual cacheing---or use an an alternative scheme in which you knit to regular markdown only once and then use make to control the PDF conversions. I demonstrate the alternative in [another repository](https://github.com/agoldst/tex/blob/master/rmd-slides/).)

The Makefile also has a target for converting the PDF with slides into a Keynote file using [PDF To Keynote](https://www.cs.hmc.edu/~oneill/freesoftware/pdftokeynote.html). Keynote's presenter mode is superior to any of the PDF-viewer options.
